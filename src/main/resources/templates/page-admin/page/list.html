<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
                xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>상위 페이지 목록</title>

    <th:block th:replace="~{fragment/common :: commonStatic}"></th:block>
    <th:block th:replace="~{fragment/framework :: uikit}"></th:block>
    <th:block th:replace="~{fragment/framework :: bootstrap}"></th:block>
    <th:block th:replace="~{fragment/library :: tui-grid}"></th:block>

</head>
<body>

<th:block th:replace="~{fragment/header :: commonHeader}"></th:block>

<div class="container mt-3">
    <div class="d-flex justify-content-center">
        <span class="fs-3 fw-bold">페이지 관리</span>
    </div>

    <div class="row mt-3">
        <div class="col">
            <button onclick="location.href='/page-admin/page/register'" type="button" class="btn btn-dark btn-sm w-25 float-start">상위 추가</button>
        </div>
        <div class="col">
            <button type="button" class="btn btn-dark btn-sm w-25">하위 추가</button>
        </div>
    </div>

    <div class="d-flex">
        <div id = 'gridTarget' class="w-50"></div>
        <div id = 'gridSub' class="w-50"></div>
    </div>

</div>

</body>

<script type="application/javascript" th:inline="javascript">
    // csrf token
    let headers = {
    /*[[${_csrf.headerName}]]*/
    :
    /*[[${_csrf.token}]]*/
    }

    const Grid = tui.Grid;
    Grid.applyTheme('striped'); // Call API of static method
    Grid.setLanguage("ko")

    let gridTarget;
    let gridSub;

    main()

    function main(){

        initElement()

        initGrid()

        initClickEvent()
    }

    async function initGrid(){
        gridTarget = new Grid({
            el: document.getElementById("gridTarget"),
            rowHeaders: ['rowNum'],
            columns: [
                {
                    header: '상위 페이지 아이디', name: 'parentPageId', align: 'center', hidden: true
                },
                {
                    header: '수정하기', width: 75, align: 'center',
                    formatter : function (e){
                        console.log(e)
                        console.log(e.row.parentPageId)
                        let path = "/page-admin/page/list/update?id=" + e.row.parentPageId;
                        return "<a href='" + path + "'>수정하기</a>"
                    },
                    resizable : false
                },
                {
                    header : '페이지 명', name: 'parentPageTitle', width : 150, align: 'center',
                    resizable : true,
                    sortable : true,
                    filter: 'select'
                },
                {
                    header: '루트 경로', name: 'parentPageRootPath', width: 150, align : 'center',
                    resizable : true,
                    sortable : true,
                    filter: 'select'
                },
                {
                    header: '인덱스 경로', name: 'parentPageIndexPath', width: 150, align: 'center',
                    resizable : true,
                    sortable : true,
                    filter: 'select'
                },
            ],
            data: {
                api: {
                    readData: {
                        url : '/api/parent-page',
                        method : 'GET',
                        initParams : {}
                    }
                },
                contentType: 'application/json',
                headers : headers
            },
            pageOptions: {
                perPage: 30
            },
            bodyHeight: 300
        })

        gridSub = new Grid({
            el: document.getElementById("gridSub"),
            rowHeaders: ['rowNum'],
            columns: [
                {
                    header: '하위 페이지 아이디', name: 'subPageId', align: 'center', hidden: true
                },
                {
                    header: '수정하기', width: '75', align: 'center',
                    formatter : function (e){
                        return "<button>수정하기</button>"
                    },
                    resizable : true
                },
                {
                    header : '페이지 명', name: 'subPageTitle', width : '150', align: 'center',
                    resizable : true,
                    sortable : true,
                    filter: 'select'
                },
                {
                    header: '서브 페이지 경로', name: 'subPagePath', width: 150, align : 'center',
                    resizable : true,
                    sortable : true,
                    filter: 'select'
                },
                {
                    header: '권한코드', name: 'pageAuthorityConditionCode', width: 150, align : 'center',
                    resizable : true,
                    sortable : true,
                    filter: 'select'
                },
            ],
            data: {
                api: {
                    readData: {
                        url : '',
                        method : 'GET',
                        initParams : {}
                    }
                },
                contentType: 'application/json',
                headers : headers
            },
            pageOptions: {
                perPage: 30
            },
            bodyHeight: 300,
            selectionUnit: 'row'
        })
    }

    function initElement() {

    }

    function initClickEvent() {
        // document.getElementById("searchButton").addEventListener("click", function (e){
        //     gridTarget.readData(null, collectData("searchForm"), true)
        // })
        gridTarget.on('dblclick', function(ev) {
            var record = {
                start : [ev.rowKey, 0],
                end : [ev.rowKey, gridTarget.getColumns().length]
            }
            gridTarget.setSelectionRange(record);
        });
    }


</script>
</html>